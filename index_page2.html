<!DOCTYPE html>
<html>

<style>
body {
  font-family: Arial;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  display: grid;
  grid-template-columns: 1fr; /*1 row type shi */
  gap: 15px;
  width: 750px;
}


button {
  padding: 18px;
  font-size: 18px;
  width: 100%;
}


.full {
  background: #ccc;
}
</style>
</head>
    <title>Selection page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

<body style="background-color:lightgreen">

<div class="container">
  <button onclick="choose('Welfare Division')" id="Welfare Division"></button>
  <button onclick="choose('Equipment & Instrument Division')" id="Equipment & Instrument Division"></button>
  <button onclick="choose('Public Relation')" id="Public Relation"></button>
  <button onclick="choose('Human Resources')" id="Human Resources"></button>
</div>

<button onclick="resetChoices()">Reset Choices</button>




<script>


/*if (localStorage.getItem("submitted")) {
  location.href = "index_page3.html";
}*/

const MAX = 15;
const options = ["Welfare Division", "Equipment & Instrument Division", "Public Relation", "Human Resources"];

// block user if already chosen


// initialize counts
options.forEach(opt => {
  if (!localStorage.getItem(opt)) {
    localStorage.setItem(opt, 0);
  }
});

function resetChoices() {
  if (!confirm("Reset all choices back to 15?")) return;

  options.forEach(opt => {
    localStorage.setItem(opt, 0);
  });

  localStorage.removeItem("chosen");
  localStorage.removeItem("submitted");

  render(); // refresh button text
}


function render() {
  options.forEach(opt => {
    const count = parseInt(localStorage.getItem(opt));
    const btn = document.getElementById(opt);

    if (count >= MAX) {
      btn.textContent = opt + " (FULL)";
      btn.disabled = true;
      btn.classList.add("full");
    } else {
      btn.textContent = opt + " (" + (MAX - count) + " left)";
    }
  });
}

function choose(opt) {
  console.log("User chose:", opt);

  let count = parseInt(localStorage.getItem(opt));
  if (count >= MAX) return;

  localStorage.setItem("chosen", opt);
  localStorage.setItem(opt, count + 1);

  sendToGoogleSheet(opt);
}


async function sendToGoogleSheet(choice) {
  const user = JSON.parse(localStorage.getItem("userInfo"));
  if (!user) return;

  const payload = {
    name: user.name,
    sur: user.sur,
    nick: user.nick,
    id: user.id,
    clazz: user.clazz,
    classNum: user.classNum,
    music: choice
  };

  try {
    await fetch(
      "https://script.google.com/macros/s/AKfycbyEFgwQEO6bhVK9SDREKz42JNZP6rEX0ULxI8bTInkBGR-ngu5edq_J8c8e4TXfZ3YC/exec",
      {
        method: "POST",
        mode: "no-cors",   // ðŸ”‘ REQUIRED
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      }
    );

    // DO NOT read response
    // DO NOT console.log response

    localStorage.setItem("submitted", "yes");

    // small delay to ensure request is sent
    setTimeout(() => {
      location.href = "index_page3.html";
    }, 300);

  } catch (e) {
    console.error("Fetch failed", e);
  }
}





render();
</script>

</body>
</html>
